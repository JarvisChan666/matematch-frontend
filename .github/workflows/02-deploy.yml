# name: CICD
# # 触发条件为 push
# on:
#   push:
#     branches:
#       - master
#     # 修改文件范围, 不在范围内不触发
#     paths:
#       - '.github/workflows/**'
#       - '__test__/**'
#       - 'src/**'
# # 任务
# jobs:
#   test:
#     # 运行的环境
#     runs-on: ubuntu-latest
#     # 步骤
#     steps:
#       - uses: actions/checkout@v3 # git pull
#       - name: Use Node.js
#         uses: actions/setup-node@v2
#         with:
#           node-version: 20
#       - name: 打包镜像
#         run: |
#           docker login -u ${{ secrets.REGISTRY_USERNAME }} -p ${{ secrets.REGISTRY_PASSWORD }}
#           docker build --platform linux/amd64 -t matematch-frontend:1.0 .
#           docker tag matematch-frontend:1.0 ${{ secrets.DOCKER_REPOSITORY }}
#           docker push ${{ secrets.DOCKER_REPOSITORY }}
#       - name: 登录服务器, 执行脚本
#         uses: appleboy/ssh-action@master
#         with:
#           host: ${{ secrets.REMOTE_HOST }}
#           port: 22
#           username: ${{ secrets.REMOTE_USERNAME }}
#           password: ${{ secrets.REMOTE_PASSWORD }}
#           key: ${{ secrets.REMOTE_KEY }}
#           script: |
#             docker pull jarvischan630/matematch-frontend:1.0
#             docker run --name matematch-frontend -d -p 8081:80 jarvischan630/matematch-frontend:1.0
#             docker stop matematch-frontend
#             docker rm matematch-frontend
#             docker run --name matematch-frontend -d -p 8081:80 jarvischan630/matematch-frontend:1.0
#             docker image prune -f
#             docker container prune -f
